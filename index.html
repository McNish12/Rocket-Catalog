<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rocket Catalog</title>

  <!-- Honors font for bold headings -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&display=swap" rel="stylesheet">

  <style>
    /* ==== Honors tokens ==== */
    :root{
      --brand:#f4a300;        /* Honors gold */
      --brand-dark:#cc8700;   /* hover */
      --text:#212121;
      --muted:#6b7280;
      --bg:#ffffff;
      --pad:16px;
      --radius:14px;
      --wrap:1200px;
    }

    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif}

    /* Top utility bar */
    .topbar{background:#111;color:#fff;font-size:13px}
    .topbar .wrap{max-width:var(--wrap);margin:0 auto;padding:6px var(--pad);display:flex;gap:18px;justify-content:flex-end}
    .topbar a{color:#fff;text-decoration:none;opacity:.9}
    .topbar a:hover{opacity:1;text-decoration:underline}

    /* Header with logo + nav */
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;z-index:10}
    .nav{max-width:var(--wrap);margin:0 auto;padding:12px var(--pad);display:flex;align-items:center;gap:24px}
    .brand img{height:40px;width:auto;display:block}
    .navlinks{margin-left:auto;display:flex;gap:18px;flex-wrap:wrap}
    .navlinks a{font-family:Montserrat,system-ui;font-weight:700;text-transform:uppercase;font-size:14px;color:#111;text-decoration:none;padding:6px 8px;border-radius:8px}
    .navlinks a:hover{color:var(--brand)}

    /* Controls row under header */
    .controls{max-width:var(--wrap);margin:0 auto;padding:0 var(--pad) 14px;display:grid;gap:10px;grid-template-columns:1fr 180px 200px 200px}
    .controls input,.controls select{padding:10px 12px;border:1px solid #ddd;border-radius:10px;background:#fff;font-size:14px}

    /* Hero (static banner instead of Smart Slider) */
    .hero{background:url('HERO_URL') center/cover no-repeat;color:#fff;text-align:center}
    .hero .shade{background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.35));}
    .hero .inner{max-width:var(--wrap);margin:0 auto;padding:80px var(--pad)}
    .hero h1{font-family:Montserrat,system-ui;font-weight:700;text-transform:uppercase;font-size:40px;margin:0 0 6px}
    .hero p{margin:0;opacity:.9}

    /* Main content */
    main .wrap{max-width:var(--wrap);margin:0 auto;padding:18px var(--pad)}
    .muted{color:var(--muted);font-size:12px}

    /* Cards */
    .cards{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
    .card{background:#fff;border:1px solid #eee;border-radius:var(--radius);box-shadow:0 1px 2px rgba(0,0,0,.06);display:flex;flex-direction:column;overflow:hidden;text-decoration:none;color:inherit}
    .thumb{aspect-ratio:4/3;background:#fafafa;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .meta{padding:12px 14px;display:grid;gap:8px}
    .name{font-family:Montserrat,system-ui;font-weight:700}
    .price{font-family:Montserrat,system-ui;font-weight:700}
    .sizes{border-top:1px dashed #eee;padding:10px 14px;font-size:13px;line-height:1.6;color:#333}
    .sizes dt{font-family:Montserrat,system-ui;font-weight:700}
    .actions{display:flex;gap:8px;padding:12px 14px 14px}
    .btn{border:1px solid var(--brand);background:var(--brand);color:#fff;border-radius:10px;padding:8px 10px;font-size:14px;text-decoration:none;cursor:pointer}
    .btn:hover{background:var(--brand-dark);border-color:var(--brand-dark)}
    #detail .layout{display:grid;gap:24px}
    @media(min-width:800px){#detail .layout{grid-template-columns:1fr 1fr}}
    #detail img{max-width:100%;height:auto}
    #detail .gallery{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    #detail .gallery img{width:120px;height:120px;object-fit:cover;border:1px solid #eee;border-radius:var(--radius)}

    /* Footer */
    footer{border-top:1px solid #eee;background:#fff}
    footer .wrap{max-width:var(--wrap);margin:0 auto;padding:20px var(--pad);display:flex;gap:24px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    footer img{height:50px;width:auto}

    @media (max-width:800px){
      .controls{grid-template-columns:1fr}
      .navlinks{display:none}
      .hero .inner{padding:56px var(--pad)}
      .hero h1{font-size:30px}
    }
    .controls{display:none}
  </style>
</head>
<body>

  <!-- Top utility bar -->
  <div class="topbar">
    <div class="wrap">
      <span>Email: <a href="mailto:sales@honorsone.com">sales@honorsone.com</a></span>
      <span>•</span>
      <a href="tel:+12485825200">248.582.5200</a>
    </div>
  </div>

  <!-- Header + nav -->
  <header>
    <div class="nav">
      <a class="brand" href="https://www.honorsone.com/" target="_blank" rel="noopener">
        <img src="https://github.com/McNish12/Rocket-Catalog/blob/main/images/Honors%20Thick%20Logo.png?raw=true
" alt="Honors">
      </a>
      <nav class="navlinks" id="nav"></nav>
    </div>

    <!-- Search + filters -->
    <div class="controls">
      <input id="q" placeholder="Search products, tags, vendor…" />
      <select id="cat"><option value="">All Categories</option></select>
      <select id="imp"><option value="">All Imprint Methods</option></select>
      <select id="tag"><option value="">All Tags</option></select>
    </div>
  </header>

  <!-- Hero banner -->
  <section class="hero">
    <div class="shade">
      <div class="inner">
        <h1>Rocket Approved Awards</h1>
        <p>Live catalog • Pulled from Google Sheets</p>
      </div>
    </div>
  </section>

  <!-- Catalog -->
  <main>
    <div class="wrap">
      <div id="count" class="muted" style="padding:4px 2px 12px"></div>
      <div id="cards"></div>
    </div>
  </main>

  <section id="detail" style="display:none;">
    <div class="wrap">
      <div id="detail-content"></div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="wrap">
      <img src="images/Honors%20Thick%20Logo.png" alt="Honors">
      <div>
        997 Rochester Road, Suite A • Troy, Michigan 48083<br>
        <a href="mailto:sales@honorsone.com">sales@honorsone.com</a> • 248.582.5200
      </div>
    </div>
  </footer>

  <!-- ===== Catalog JS: same logic, just wrapped in this file ===== -->
  <script>
    // Published-to-web CSVs for Products & Variants
    const PRODUCTS_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQyKnlMtRQJKbmCkI7loITX-K8M-iF8jUfSwSQOw8wIio1eZLFKq_WsAfArkfG4eaGKQkuV3imHocOv/pub?gid=653601520&single=true&output=csv";
    const VARIANTS_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQyKnlMtRQJKbmCkI7loITX-K8M-iF8jUfSwSQOw8wIio1eZLFKq_WsAfArkfG4eaGKQkuV3imHocOv/pub?gid=140795318&single=true&output=csv";

    async function fetchCSV(url){ const res=await fetch(url,{cache:'no-store'}); const text=await res.text(); return parseCSV(text); }
    function parseCSV(text){
      const rows=[]; let row=[], cur="", q=false;
      for(let i=0;i<text.length;i++){
        const c=text[i],n=text[i+1];
        if(q){ if(c==='\"'&&n==='\"'){cur+='\"';i++;} else if(c==='\"'){q=false;} else cur+=c; }
        else { if(c==='\"') q=true; else if(c===','){row.push(cur);cur="";}
        else if(c==='\n'||c==='\r'){ if(cur!==""||row.length){row.push(cur);rows.push(row);row=[];cur="";} }
        else cur+=c; }
      }
      if(cur!==""||row.length){row.push(cur);rows.push(row);}
      const headers=rows.shift().map(h=>h.trim());
      return rows.filter(r=>r.length).map(r=>{const o={}; headers.forEach((h,i)=>o[h]=r[i]??""); return o;});
    }
    const norm=s=>(s||'').toString().toLowerCase();
    const normId=id=>norm(id).replace(/^rk-/,'');
    const toNum=x=>{ if(x==null) return null; const n=Number(String(x).replace(/[^0-9.\-]/g,'')); return isFinite(n)?n:null; };
    const uniq=a=>[...new Set(a)];
    const fmtUSD=new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'});
    function displayPrice(p){ const n=Number(p); return Number.isFinite(n)?fmtUSD.format(n):'Quote Upon Request'; }
    function slug(s){ return String(s).toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
    function buildNavFromCategories(products){
      const categories=[...new Set(products.map(p=>p.category).filter(Boolean))].sort();
      const navEl=document.querySelector('#nav');
      if(!navEl) return;
      navEl.innerHTML=categories.map(cat=>`<a href="#/c/${slug(cat)}" class="nav-link">${cat}</a>`).join('');
    }

    // Resolve values using possible header aliases
    function pick(row, aliases){
      for(const key of aliases){
        const v=row[key];
        if(v!=null && String(v).trim()!=='') return v;
      }
      return '';
    }

    // Acceptable column names for each logical field
    const PRODUCT_COLS={
      status:    ['Status','Approval Status','status'],
      slug:      ['Slug','Product ID','product_id','slug','ID','id'],
      name:      ['Product Name','Name','Item Name','title'],
      category:  ['Category','Categories','category'],
      preview:   ['Preview Link','3D Preview URL','Preview URL','model_3d_url','Model 3D URL'],
      thumb:     ['Thumbnail URL','Image','Image URL','Primary Image','primary_image_url','image_url','primary image'],
      description:['Description','Product Description','description'],
      gallery:   ['Gallery URLs','Gallery','gallery_urls','gallery'],
      approved:  ['Approved','approved']
    };
    const VARIANT_COLS={
      productId: ['Product ID','product_id','Slug','slug','ID','id'],
      size:      ['Size','Option','Variant','Spec','option1_value','size'],
      price:     ['Price','Unit Price','Cost','price','unit_price']
    };

    function logUnmatched(rows, cols, label){
      const sample=rows.slice(0,3).map((row,i)=>{
        const missing=[];
        for(const [field,aliases] of Object.entries(cols)){
          if(!aliases.some(a=>a in row)) missing.push(field);
        }
        return missing.length?{row:i+1,missing}:null;
      }).filter(Boolean);
      if(sample.length) console.warn(`Unmatched ${label} columns`, sample);
    }

    async function main(){
      const [products, variants] = await Promise.all([fetchCSV(PRODUCTS_CSV), fetchCSV(VARIANTS_CSV)]);

      logUnmatched(products, PRODUCT_COLS, 'product');
      logUnmatched(variants, VARIANT_COLS, 'variant');

      const byProduct = variants.reduce((m,v)=>{
        const k=normId(pick(v, VARIANT_COLS.productId));
        if(!k) return m;
        const size=pick(v, VARIANT_COLS.size);
        const price=pick(v, VARIANT_COLS.price);
        (m[k]=m[k]||[]).push({size,price});
        return m;
      }, {});

      const statuses = products.map(p=>pick(p, PRODUCT_COLS.status));
      const approvals = products.map(p=>pick(p, PRODUCT_COLS.approved));
      const catalog = products
        .filter((p,i) => norm(statuses[i])==='approved' || norm(approvals[i])==='true')
        .map(p=>{
          const id=normId(pick(p, PRODUCT_COLS.slug));
          const name=pick(p, PRODUCT_COLS.name);
          const vs=(byProduct[id]||[]).slice();
          const nums=vs.map(v=>toNum(v.price)).filter(n=>n!=null);
          const minPrice=nums.length?Math.min(...nums):null;
          const maxPrice=nums.length?Math.max(...nums):null;
          vs.sort((a,b)=>{const na=toNum(a.price),nb=toNum(b.price); if(na!=null&&nb!=null) return na-nb; if(na!=null) return -1; if(nb!=null) return 1; return (a.size||'').localeCompare(b.size||'');});
          return {
            id,
            name,
            category:pick(p, PRODUCT_COLS.category),
            preview:pick(p, PRODUCT_COLS.preview),
            thumb:pick(p, PRODUCT_COLS.thumb),
            description:pick(p, PRODUCT_COLS.description),
            gallery:pick(p, PRODUCT_COLS.gallery),
            variants:vs,
            minPrice,maxPrice
          };
        });
      buildNavFromCategories(catalog);

      if(!catalog.length){
        const msg = (products.length && (statuses.some(s=>String(s).trim()) || approvals.some(a=>String(a).trim())))
          ? 'No approved products found.'
          : 'Check published CSV headers—no matching aliases found.';
        document.getElementById('cards').innerHTML =
          `<div style="padding:16px;color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;border-radius:10px;">${msg}</div>`;
        return;
      }

      const cardsEl=document.getElementById('cards'), countEl=document.getElementById('count');
      function renderCatalog(catSlug){
        const list=catalog.filter(p=>!catSlug || slug(p.category)===catSlug);
        countEl.textContent = `${list.length} product${list.length===1?'':'s'} shown`;
        cardsEl.innerHTML='';
        const groups={};
        list.forEach(p=>{const c=p.category||'Other';(groups[c]=groups[c]||[]).push(p);});
        Object.keys(groups).sort().forEach(cat=>{
          const h=document.createElement('h3'); h.textContent=cat; cardsEl.appendChild(h);
          const grid=document.createElement('div'); grid.className='cards';
          groups[cat].forEach(p=>grid.appendChild(card(p)));
          cardsEl.appendChild(grid);
        });
      }

      function card(p){
        const wrap=document.createElement('a'); wrap.className='card'; wrap.href=`#/p/${p.id}`;
        const t=document.createElement('div'); t.className='thumb';
        const img=document.createElement('img'); img.alt=p.name; img.src=p.thumb||'https://via.placeholder.com/800x600?text=No+Image'; t.appendChild(img);

        const meta=document.createElement('div'); meta.className='meta';
        const name=document.createElement('div'); name.className='name'; name.textContent=p.name;

        const price=document.createElement('div'); price.className='price';
        if(p.minPrice!=null && p.maxPrice!=null){
          const min=displayPrice(p.minPrice);
          const max=displayPrice(p.maxPrice);
          price.textContent = (p.minPrice===p.maxPrice)? min : `${min} – ${max}`;
        } else {
          price.textContent = displayPrice('');
        }

        meta.appendChild(name); if(price.textContent) meta.appendChild(price);
        wrap.appendChild(t); wrap.appendChild(meta);
        return wrap;
      }

      window.renderCatalog=renderCatalog;

      function showDetail(id){
        const product=catalog.find(p=>p.id===id);
        const mainEl=document.querySelector('main');
        const detailEl=document.getElementById('detail');
        if(!product){ location.hash=''; return; }
        mainEl.style.display='none';
        detailEl.style.display='block';
        const c=document.getElementById('detail-content');
        c.innerHTML='';
        const back=document.createElement('a'); back.href='#'; back.className='btn'; back.textContent='← Back to Catalog'; c.appendChild(back);
        const title=document.createElement('h2'); title.textContent=product.name; c.appendChild(title);
        const layout=document.createElement('div'); layout.className='layout';
        const imgCol=document.createElement('div');
        const mainImg=document.createElement('img'); mainImg.src=product.thumb||'https://via.placeholder.com/800x600?text=No+Image'; imgCol.appendChild(mainImg);
        const gallery=(product.gallery||'').split(',').map(s=>s.trim()).filter(Boolean);
        if(gallery.length){
          const g=document.createElement('div'); g.className='gallery';
          gallery.forEach(u=>{const im=document.createElement('img'); im.src=u; g.appendChild(im);});
          imgCol.appendChild(g);
        }
        layout.appendChild(imgCol);
        const info=document.createElement('div');
        if(product.description){ const pDesc=document.createElement('p'); pDesc.textContent=product.description; info.appendChild(pDesc); }
        if(product.preview){ const iframe=document.createElement('iframe'); iframe.src=product.preview; iframe.loading='lazy'; iframe.style.width='100%'; iframe.style.height='480px'; iframe.style.border='0'; info.appendChild(iframe); }
        if(product.variants && product.variants.length){ const sizes=document.createElement('div'); sizes.className='sizes'; const dl=document.createElement('dl'); const dt=document.createElement('dt'); dt.textContent='Sizes & Prices'; dl.appendChild(dt); product.variants.forEach(v=>{ const dd=document.createElement('dd'); dd.textContent=`${v.size||''} — ${displayPrice(v.price)}`; dl.appendChild(dd); }); sizes.appendChild(dl); info.appendChild(sizes); }
        layout.appendChild(info);
        c.appendChild(layout);
      }

      function handleRoute(){
        const hash=location.hash;
        const mainEl=document.querySelector('main');
        const detailEl=document.getElementById('detail');
        if(hash.startsWith('#/p/')){
          showDetail(hash.slice(4));
        } else {
          detailEl.style.display='none';
          mainEl.style.display='block';
          const m=hash.match(/^#\/c\/(.+)$/);
          renderCatalog(m?m[1]:'');
        }
      }

      window.addEventListener('hashchange', handleRoute);
      handleRoute();
    }

    main().catch(err=>{
      document.getElementById('cards').innerHTML =
        `<div style="padding:16px;color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;border-radius:10px;">
           Error loading data. Check the published CSV URLs.<br><br>
           <small>${err}</small>
         </div>`;
    });
  </script>
</body>
</html>
