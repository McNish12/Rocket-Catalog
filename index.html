# Recreate the deploy-ready index.html wired to the user's published CSV URLs.

products_csv = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQyKnlMtRQJKbmCkI7loITX-K8M-iF8jUfSwSQOw8wIio1eZLFKq_WsAfArkfG4eaGKQkuV3imHocOv/pub?gid=653601520&single=true&output=csv"
variants_csv = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQyKnlMtRQJKbmCkI7loITX-K8M-iF8jUfSwSQOw8wIio1eZLFKq_WsAfArkfG4eaGKQkuV3imHocOv/pub?gid=140795318&single=true&output=csv"

html = f"""<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rocket Catalog</title>
  <style>
    :root {{ --pad:16px; --radius:14px; --muted:#6b7280; --bg:#f7f7f9; }}
    *{{box-sizing:border-box}}
    body{{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;background:var(--bg);color:#111}}
    header{{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;z-index:2}}
    .wrap{{max-width:1200px;margin:0 auto;padding:14px var(--pad)}}
    .title{{font-weight:700;font-size:20px}}
    .controls{{display:grid;gap:10px;grid-template-columns:1fr 180px 180px 180px}}
    .controls input,.controls select{{padding:10px 12px;border:1px solid #ddd;border-radius:10px}}
    main .wrap{{padding:18px var(--pad)}}
    .muted{{color:var(--muted);font-size:12px}}
    .cards{{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}}
    .card{{background:#fff;border:1px solid #eee;border-radius:var(--radius);box-shadow:0 1px 2px rgba(0,0,0,.05);display:flex;flex-direction:column;overflow:hidden}}
    .thumb{{aspect-ratio:4/3;background:#fafafa;display:flex;align-items:center;justify-content:center}}
    .thumb img{{width:100%;height:100%;object-fit:cover}}
    .meta{{padding:12px 14px;display:grid;gap:8px}}
    .name{{font-weight:600}}
    .sub{{color:#555;font-size:13px}}
    .chip{{display:inline-block;padding:2px 8px;border-radius:999px;background:#f1f1f5;font-size:12px;margin-right:6px}}
    .price{{font-weight:700}}
    .sizes{{border-top:1px dashed #eee;padding:10px 14px;font-size:13px;line-height:1.6;color:#333}}
    .sizes dt{{font-weight:600}}
    .sizes dd{{margin:0 0 6px 0}}
    .actions{{display:flex;gap:8px;padding:12px 14px 14px}}
    .btn{{border:1px solid #ddd;background:#fff;border-radius:10px;padding:8px 10px;font-size:14px;text-decoration:none;color:#111}}
    .btn.primary{{background:#0b57d0;border-color:#0b57d0;color:#fff}}
    @media (max-width:800px){{.controls{{grid-template-columns:1fr}}}}
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;align-items:center;gap:16px;flex-wrap:wrap">
      <div class="title">Rocket Catalog</div>
      <div class="controls" style="flex:1 1 600px">
        <input id="q" placeholder="Search products, tags, vendor…" />
        <select id="cat"><option value="">All Categories</option></select>
        <select id="imp"><option value="">All Imprint Methods</option></select>
        <select id="tag"><option value="">All Tags</option></select>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div id="count" class="muted" style="padding:4px 2px 12px"></div>
      <div id="cards" class="cards"></div>
    </div>
  </main>

  <script>
    const PRODUCTS_CSV = "{products_csv}";
    const VARIANTS_CSV = "{variants_csv}";

    async function fetchCSV(url){ const res=await fetch(url,{{cache:'no-store'}}); const text=await res.text(); return parseCSV(text); }
    function parseCSV(text){ const rows=[]; let row=[], cur="", q=false; for(let i=0;i<text.length;i++){{const c=text[i],n=text[i+1]; if(q){{ if(c==='\"'&&n==='\"'){{cur+='\"';i++;}} else if(c==='\"'){{q=false;}} else cur+=c;}} else {{ if(c==='\"')q=true; else if(c===','){{row.push(cur);cur=\"\";}} else if(c==='\\n'||c==='\\r'){{ if(cur!==\"\"||row.length){{row.push(cur);rows.push(row);row=[];cur=\"\";}} }} else cur+=c;}}} if(cur!==\"\"||row.length){{row.push(cur);rows.push(row);}} const headers=rows.shift().map(h=>h.trim()); return rows.filter(r=>r.length).map(r=>{{const o={{}}; headers.forEach((h,i)=>o[h]=r[i]??\"\"); return o;}}); }
    function toNum(x){{ if(x==null) return null; const n=Number(String(x).replace(/[^0-9.\\-]/g,'')); return isFinite(n)?n:null; }}
    function uniq(a){{ return [...new Set(a)]; }}
    const norm = s => (s||'').toString().toLowerCase();

    async function main(){ 
      const [products, variants] = await Promise.all([fetchCSV(PRODUCTS_CSV), fetchCSV(VARIANTS_CSV)]);
      const byProduct = variants.reduce((m,v)=>{{const key=(v['Product Name']||'').trim(); if(!key)return m; (m[key]=m[key]||[]).push(v); return m;}},{{}});
      const catalog = products.filter(p=>norm(p.Status)==='approved').map(p=>{{ 
        const name=p['Product Name']||''; const vs=(byProduct[name]||[]).slice();
        const nums=vs.map(v=>toNum(v.Price)).filter(n=>n!=null); 
        const minPrice=nums.length?Math.min(...nums):null; const maxPrice=nums.length?Math.max(...nums):null;
        vs.sort((a,b)=>{{const na=toNum(a.Price), nb=toNum(b.Price); if(na!=null&&nb!=null) return na-nb; if(na!=null) return -1; if(nb!=null) return 1; return (a.Size||'').localeCompare(b.Size||'');}});
        return {{ 
          name,
          category:p.Category||'', vendor:p.Vendor||'', vendorSku:p['Vendor SKU']||'',
          preview:p['Preview Link']||'', thumb:p['Thumbnail URL']||'',
          setup:p['Setup Charge (USD)']||'', repeat:p['Repeat Setup (USD)']||'',
          setupNotes:p['Setup Notes']||'', imprint:p['Imprint Method']||'',
          lead:p['Lead Time (days)']||'', minQty:p['Min Qty']||'', tags:p.Tags||'',
          variants:vs, minPrice, maxPrice
        }};
      }});

      const facets={{ 
        categories: uniq(catalog.map(c=>c.category).filter(Boolean)).sort(),
        imprints: uniq(catalog.map(c=>c.imprint).filter(Boolean)).sort(),
        tags: uniq(catalog.flatMap(c => (c.tags? c.tags.split(',').map(s=>s.trim()).filter(Boolean):[]))).sort()
      }};

      const catEl=document.getElementById('cat'), impEl=document.getElementById('imp'), tagEl=document.getElementById('tag');
      facets.categories.forEach(v=>catEl.append(new Option(v,v)));
      facets.imprints.forEach(v=>impEl.append(new Option(v,v)));
      facets.tags.forEach(v=>tagEl.append(new Option(v,v)));

      const qEl=document.getElementById('q'); const cardsEl=document.getElementById('cards'); const countEl=document.getElementById('count');
      function render(){ 
        const q=norm(qEl.value), cat=norm(catEl.value), imp=norm(impEl.value), tag=norm(tagEl.value);
        const list=catalog.filter(p=>{{ if(cat && norm(p.category)!==cat) return false; if(imp && norm(p.imprint)!==imp) return false; if(tag){{const t=(p.tags||'').split(',').map(s=>norm(s.trim())).filter(Boolean); if(!t.includes(tag)) return false;}} if(q){{const hay=[p.name,p.category,p.vendor,p.vendorSku,p.imprint,p.tags].join(' ').toLowerCase(); if(!hay.includes(q)) return false;}} return true; }});
        countEl.textContent = `${{list.length}} product${{list.length===1?'':'s'}} shown`;
        cardsEl.innerHTML=''; list.forEach(p=>cardsEl.appendChild(card(p)));
      }
      function card(p){ 
        const wrap=document.createElement('div'); wrap.className='card';
        const t=document.createElement('div'); t.className='thumb'; const img=document.createElement('img'); img.alt=p.name; img.src=p.thumb||'https://via.placeholder.com/800x600?text=No+Image'; t.appendChild(img);
        const meta=document.createElement('div'); meta.className='meta'; const name=document.createElement('div'); name.className='name'; name.textContent=p.name;
        const sub=document.createElement('div'); sub.className='sub'; const bits=[]; if(p.category)bits.push(p.category); if(p.imprint)bits.push(p.imprint); if(p.minQty)bits.push(`Min ${{p.minQty}}`); sub.textContent=bits.join(' • ');
        const price=document.createElement('div'); price.className='price'; if(p.minPrice!=null && p.maxPrice!=null) price.textContent=(p.minPrice===p.maxPrice)? `$${{p.minPrice.toFixed(2)}}` : `$${{p.minPrice.toFixed(2)}} – $${{p.maxPrice.toFixed(2)}}`;
        const chips=document.createElement('div'); 
        if(p.setup){{const c=document.createElement('span'); c.className='chip'; c.textContent=`Setup: $${{p.setup}}`; chips.appendChild(c);}}
        if(p.repeat){{const c=document.createElement('span'); c.className='chip'; c.textContent=`Repeat: $${{p.repeat}}`; chips.appendChild(c);}}
        if(p.lead){{const c=document.createElement('span'); c.className='chip'; c.textContent=`Lead: $${{p.lead}}d`; chips.appendChild(c);}}
        meta.appendChild(name); if(sub.textContent) meta.appendChild(sub); if(price.textContent) meta.appendChild(price); if(chips.children.length) meta.appendChild(chips);
        const sizes=document.createElement('div'); sizes.className='sizes';
        if(p.variants && p.variants.length){{ const dl=document.createElement('dl'); const dt=document.createElement('dt'); dt.textContent='Sizes & Prices'; dl.appendChild(dt); p.variants.forEach(v=>{{ const dd=document.createElement('dd'); dd.textContent=`${{v.Size||''}} — ${{v.Price||''}}`; dl.appendChild(dd); }}); sizes.appendChild(dl);}}
        else {{ sizes.innerHTML='<span class=\"muted\">No sizes listed yet</span>'; }}
        const actions=document.createElement('div'); actions.className='actions'; 
        if(p.preview){{ const a=document.createElement('a'); a.className='btn primary'; a.href=p.preview; a.target='_blank'; a.rel='noopener'; a.textContent='3D Preview'; actions.appendChild(a);}}
        if(p.vendorSku){{ const s=document.createElement('span'); s.className='muted'; s.textContent=`SKU: ${{p.vendorSku}}`; actions.appendChild(s);}}
        wrap.appendChild(t); wrap.appendChild(meta); wrap.appendChild(sizes); wrap.appendChild(actions); return wrap;
      }
      qEl.addEventListener('input', render); catEl.addEventListener('change', render); impEl.addEventListener('change', render); tagEl.addEventListener('change', render); render();
    }
    main().catch(err=>{ document.getElementById('cards').innerHTML = `<div style="padding:16px;color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;border-radius:10px;">Error loading data. Check the published CSV URLs.<br><br><small>${{err}}</small></div>`; });
  </script>
</body>
</html>
"""

out_path = "/mnt/data/index.html"
with open(out_path, "w", encoding="utf-8") as f:
    f.write(html)

out_path
